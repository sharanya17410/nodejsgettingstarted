<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Collapsible sidebar using Bootstrap 4</title>
    <script src="https://unpkg.com/scrollreveal/dist/scrollreveal.min.js"></script>
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="public/css/style2.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

</head>

<body>

    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>YOCA LLC</h3>
            </div>

            <ul class="list-unstyled components">
                <p>Menu</p>
                
                <li class="active">
                    <a href="/admin">Home</a>
                </li>
                
            <ul class="list-unstyled CTAs">
                <li>
                    <a href="/users/logout" class="download">Logout</a>
                </li>
                
            </ul>
        </nav>

        <!-- Page Content  -->
        <div id="content">

            <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top" style="position:sticky;background-color: transparent;">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn btn-dark d-inline-block ml-auto" style="position:sticky;">
                        <i class="fas fa-align-justify"></i>
                        <span>Menu</span>
                    </button>
                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="True" aria-label="Toggle navigation">
                        <i class="fas fa-align-justify"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="nav navbar-nav ml-auto">
                                <li class="nav-item active">
                                    <a class="nav-link" href="/admin">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/users/logout">Logout</a>
                                </li>
                            </ul>
                        </div>
                    
                </div>
            </nav>

            <h2>Home</h2>
            
                <button class='btn btn-dark'data-toggle="modal" data-target="#exampleModal">Create an album</button>
    
            <br>
            <br>
            <!-- Button trigger modal -->


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create an album</h5>                    
      </div>
      <div class="modal-body">
        <form method="POST" action="/test/upload" enctype="multipart/form-data">
            <div class="form-group">
                <label>Album Name</label>
                <input name ="name" type="text" class="form-control" placeholder="Enter album name">                
            </div>
            <div class="form-group">
                <label>Album description</label>
                <input name="desc" type="text" class="form-control" placeholder="Enter album description">
            </div>              
            <div class="form-group">
                <label for="exampleFormControlFile1">Select image for Album Cover</label>
                <input name="myImage" type="file" class="form-control-file" id="exampleFormControlFile1">
            </div>
            
                 <button type="submit" class="btn btn-primary createbtn">Create album</button>
   
            
        </form>
   
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Create album</button>
      </div>
    </div>
  </div>
</div>
            <div class="card-container wrapper">    
                    <div class="row albumcards">
                        {{#each albums}}
                            <div class="col-md-4 mt-6 albums" id="{{this.id}}">
                                <div class="card" id="select">  
                                    <img class="card-img-top" src="{{this.imagelink}}" alt="Card image cap">
                                    <div class="card-body text-center">
                                        <h4 class="card-title">{{this.albumtitle}}</h4>
                                        <p class="card-text span3">{{this.description}}</p>
                                        <button type="submit" id="viewPictures" class="btn btn-dark buttons">View Pictures</button>
                                        <hr>
                                        <button type="submit" id="addPicsButton" class="btn btn-dark addPics">Add Pictures</button>
                                        <hr>
                                        <button type="submit" id="deleteAlbum" class="btn btn-dark delAlbum">Delete Album</button>
                                        {{!-- <button type="submit" class="btn btn-dark buttonsdel span1 mt-2">View Pictures</button>
                                        <button type="submit" class="btn btn-dark buttonsview span1 mt-2">Delete Pictures</button> --}}
                                    </div>                           
                                </div>
                            </div>
                        {{/each}}
                    </div>
            </div>
           
            <div class="tz-gallery container">
              
                
            </div>
        </div>
    
        </div>
    </div>
</div>
    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.8.1/baguetteBox.min.js"></script>
    <script>
        $('.tz-gallery').hide();
            // ScrollReveal (https://github.com/jlmakes/scrollreveal)
    
            (function scrollReveal() {
            window.sr = ScrollReveal();
            
            sr.reveal('.card-box', {
                duration   : 600,
                distance   : '20px',
                easing     : 'ease-out',
                origin     : 'bottom',
                reset      : true,
                scale      : 1,
                viewFactor : 0,
                afterReveal  : revealChildren,
            }, 150);
            
                var revealChildren = sr.reveal('.card-title, .card-text', {
                duration   : 500,
                scale      : 1,
                distance   : '20px',
                origin     : 'bottom',
                reset      : true,
                easing     : 'ease-out',
                viewFactor : 1,
            }, 75);
            })();
    
        </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#sidebar").mCustomScrollbar({
                theme: "minimal"
            });

            $('#sidebarCollapse').on('click', function () {
                $('#sidebar, #content').toggleClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });
        });
    </script>
   
<script>
    var buttons_add = document.getElementsByClassName('addPics');
       // console.log(buttons);
for (var i = 0; i < buttons_add.length; i++) {
//console.log(document.getElementsByClassName('addpictures'));
buttons_add[i].addEventListener('click',function(){
    console.log('yay i was clicked');
    window.location.href = '/addPictures/'+$(this).closest('div').parent().parent().attr("id");;
   //      {{!-- var url="http://localhost:3000/create/"+$(this).closest('div').parent().parent().attr("id");   
     //     fetch("http://localhost:3000/view-albums")        
       //   .then(dataWrappedByPromise => dataWrappedByPromise.json())
//.then(data => {
  //  console.log(data);
//}); --}}

});}
/*{{!-- var buttons_create = document.getElementsByClassName('createbtn');
       // console.log(buttons);

//console.log(document.getElementsByClassName('addpictures'));
buttons_create.addEventListener('click',function(){
    console.log('yay i was clicked');
//    window.location.href = '/addPictures/'+$(this).closest('div').parent().parent().attr("id");;
     var url="http://localhost:3000/test/upload/"+$(this).closest('div').parent().parent().attr("id");   
     fetch("http://localhost:3000/view-albums")        
       .then(dataWrappedByPromise => dataWrappedByPromise.json())
    .then(data => {
    console.log(data);
});

}); --}}*/
//$('.add-pictures').click(function() {
  //  console.log('yay i was clicked');
    //window.location.href = '/addPictures';
    //return false;
//});       

function addevent(){
    console.log('addevent called');
  /*document.getElementsByClassName('delPics').addEventListener('click', function() {
        alert('clicked!!');
       // createGallery(this.id);
        console.log('blaaaaaaaaaaaaaaaaaaaah');*/
        
        document.getElementById('clickableAwesomeFont').addEventListener('click',function(){
           // alert('it was clicked');
            document.getElementById('clickableAwesomeFont').style.visibility = 'visible';
           console.log('haha');
        });
        $("#clickableAwesomeFont").click(function() { 
    // assumes element with id='button'
    var buttonsDelPics = document.getElementsByClassName('delPics');
        for (var i = 0; i < buttonsDelPics.length; i++) {
            buttonsDelPics[i].style.visibility='visible';
            }
    $(".delPics").toggle();
});
  
var buttonsDelPics = document.getElementsByClassName('delPics');
      // console.log(buttonsDelPics);
for (var i = 0; i < buttonsDelPics.length; i++) {
    buttonsDelPics[i].addEventListener('click', function() { 
          alert('del buttn was clicked'); 
          var url="http://localhost:3000/deletePicture/"+$(this).siblings('img').attr("id")+"/"+$(this).closest('div').parent().siblings('h1').attr('id');
         // window.location.href = '/deletePicture/'+$(this).siblings('img').attr("id");
          console.log($(this).closest('div').children('img').attr('id'));
          console.log($(this).closest('div').parent().siblings('h1').attr('id'));
     window.location.href = '/deletePicture/'+$(this).closest('div').children('img').attr('id')+"/"+$(this).closest('div').parent().siblings('h1').attr('id');
         var url="http://localhost:3000/getAlbum/"+$(this).closest('div').parent().siblings('h1').attr('id');
      /*  {{!-- fetch(url).then((response)=>{ console.log(response.json());})
        .then( (result) => {
            console.log('success:', result)
          //  $("someDiv").html(result);
        })
        .catch(error => console.log('error:', error)); --}}*/

          fetch(url)        
          .then(dataWrappedByPromise => dataWrappedByPromise.json())
.then(data => {
    // you can access your data here
    //console.log('id:'+data.album[0].imageid);
    //console.log(data);
    //console.log(data.description);
     $('.tz-gallery').show();
      $('.tz-gallery .row').empty();
                  $('.card-container').hide();
                  var output='<h1 class="text-center" id="'+data.album[data.album.length-1].id+'">'+data.album[data.album.length-3].title+'</h1>'+
                    '<p class="page-description text-center">'+ data.album[data.album.length-2].description+'</p>'+
                    '<span id="clickableAwesomeFont"><i class="fas fa-edit"></i> Edit Album</span>'+
                    '<div class="row">';                    
                  for(var i=0;i< data.album.length-3;i++){
                        output+=' <div class="col-sm-6 col-md-4">'      
                        output+='<img src="'+data.album[i].imagelink+'" id="'+data.album[i].imageid+'" class="img-fluid" alt="">'+                        
                        '<br>'+
                        '<button class="btn btn-danger delPics" style="visibility:hidden"><i class="fa fa-trash" aria-hidden="true"></i> Delete</button>'+                        
                        '</div>';}
                        output+='</div>';
                        console.log(output);
                        //baguetteBox.run('.tz-gallery',{animation: 'fadeIn',
    //noScrollbars: true});
                        document.querySelector('.tz-gallery').innerHTML=output; 
                        console.log('before addevent called');
                      //  addevent();   
                        console.log('after addevent called');             
      //                  baguetteBox.run('.tz-gallery',{animation: 'fadeIn',
    //noScrollbars: true});

})
     });}

     var buttonsCancelPics = document.getElementsByClassName('cancelPics');
       //console.log(buttonsDelPics);
for (var i = 0; i < buttonsCancelPics.length; i++) {
    buttonsCancelPics[i].addEventListener('click', function() { 
          alert('cancel buttn was clicked'); 
     //window.location.href = '/delAlbum/'+$(this).closest('div').parent().parent().attr("id");
     });}

    }
var buttons = document.getElementsByClassName('buttons');
        //console.log(buttons);
for (var i = 0; i < buttons.length; i++) {
    buttons[i].addEventListener('click', function() {    
       console.log($(this).closest('div').parent().parent().attr("id"));   
       var data =$(this).closest('div').parent().parent().attr("id");
        // var url = "";
         var url="http://localhost:3000/getAlbum/"+$(this).closest('div').parent().parent().attr("id");
      /*  {{!-- fetch(url).then((response)=>{ console.log(response.json());})
        .then( (result) => {
            console.log('success:', result)
          //  $("someDiv").html(result);
        })
        .catch(error => console.log('error:', error)); --}}*/

          fetch(url)        
          .then(dataWrappedByPromise => dataWrappedByPromise.json())
.then(data => {
    // you can access your data here
    //console.log('id:'+data.album[0].imageid);
    //console.log(data);
    //console.log(data.description);
     $('.tz-gallery').show();
      $('.tz-gallery .row').empty();
                  $('.card-container').hide();
                  var output='<h1 class="text-center" id="'+data.album[data.album.length-1].id+'">'+data.album[data.album.length-3].title+'</h1>'+
                    '<p class="page-description text-center">'+ data.album[data.album.length-2].description+'</p>'+
                    '<span id="clickableAwesomeFont"><i class="fas fa-edit"></i> Edit Album</span>'+
                    '<div class="row">';                    
                  for(var i=0;i< data.album.length-3;i++){
                        output+=' <div class="col-sm-6 col-md-4">'      
                        output+='<img src="'+data.album[i].imagelink+'" id="'+data.album[i].imageid+'" class="img-fluid" alt="">'+                        
                        '<br>'+
                        '<button class="btn btn-danger delPics" style="visibility:hidden"><i class="fa fa-trash" aria-hidden="true"></i> Delete</button>'+                        
                        '</div>';}
                        output+='</div>';
                        console.log(output);
                        //baguetteBox.run('.tz-gallery',{animation: 'fadeIn',
    //noScrollbars: true});
                        document.querySelector('.tz-gallery').innerHTML=output; 
                        console.log('before addevent called');
                        addevent();   
                        console.log('after addevent called');             
      //                  baguetteBox.run('.tz-gallery',{animation: 'fadeIn',
    //noScrollbars: true});

})
          /*  {{!-- .then(function((res) => {console.log(res.text());}))
             .catch(error => console.log('error:', error)); --}}*/
                
});
    
    }

//document.getElementsByClassName('view-albums').addEventListener('click',function(){
//         var url="http://localhost:3000/create/"+$(this).closest('div').parent().parent().attr("id");   
//          fetch("http://localhost:3000/view-albums")        
//          .then(dataWrappedByPromise => dataWrappedByPromise.json())
//.then(data => {
//    console.log(data);
//});
//}); 
var check=document.getElementById('select');
var buttons_card=Array.prototype.slice.call(check.querySelectorAll('.buttons'));
console.log(Array.prototype.slice.call(check.querySelectorAll('.buttons')));


//var children = [].slice.call(document.getElementById('select').getElementsByTagName('*'),0);

//console.log(children);
/*
var elemnts = new Array(children.length);
var arrayLength = children.length;
for (var i = 0; i < arrayLength; i++) {
    var name = children[i].getAttribute("id")||children[i].getAttribute("class");    
    elemnts[i]=name;
}
document.getElementById('output').innerHTML = elemnts.join('\</br>');*/



var buttonsDel = document.getElementsByClassName('delAlbum');
       // console.log(buttons);
for (var i = 0; i < buttons.length; i++) {
    buttonsDel[i].addEventListener('click', function() {   alert('del buttn was clicked'); 
     window.location.href = '/delAlbum/'+$(this).closest('div').parent().parent().attr("id");
     });}


var buttonsDelPics = document.getElementsByClassName('delPics');
       // console.log(buttons);
for (var i = 0; i < buttons.length; i++) {
    buttonsDel[i].addEventListener('click', function() {   alert('del buttn was clicked'); 
     //window.location.href = '/delAlbum/'+$(this).closest('div').parent().parent().attr("id");
     });}
    
</script>
</body>

</html>